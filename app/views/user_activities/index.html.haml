%h1
  = "Attività di #{current_user.name}"

#activityPage{'ng-controller' => 'UserActivitiesCtrl'}
  %fieldset
    %legend &nbsp;
    %form.well.form-inline{:method => 'POST', :action => '/user_activities/index'}
      Mese:
      = select_month @filter_date, {add_month_numbers: false, :use_short_month => true}, {name: 'month', :class => 'input-small', 'ng-model' => 'month'}
      &nbsp;&nbsp;Anno
      = select_year @filter_date, {add_month_numbers: false}, {name: 'year', :class => 'input-small', 'ng-model' => 'year'}
      &nbsp;&nbsp;Utente
      = select_tag 'user', options_from_collection_for_select(@users, "id", "email"), 'ng-model' => 'user', 'ng-init' => "user='#{@current_user.id}'"
      &nbsp;&nbsp;
      %button.btn{:type => 'button', 'ng-click' => 'filter()'} filtra

  %table.table.table-bordered.table-striped
    %thead
      %tr
        %th Data
        %th Ore
        %th Commessa
        %th Attività
        %th Note
        %th
    %tbody
      %tr{'ng-repeat' => 'a in activities'}
        %td
          %span
            {{a.date}}
          %br
          %small.grey{'ng-bind' => 'getDay(a.date)'}
            
        %td
          {{a.hours}}
        %td
          {{a.jobOrder}}
        %td
          {{a.activity}}
        %td
          {{a.description}}
        
        %td
          %a{:href => "#editActivity", "ng-click"=> "edit(a.id)", "data-toggle"=>"modal"}
            %i.icon-edit.icon-large
          %a{:href => "#", "ng-click"=> "delete(a.id)"}
            %i.icon-trash.icon-large.text-error

#editActivity.modal.hide.fade{'ng-controller' => 'UserActivityCtrl'}
  .modal-header
    %button.close{:type => 'button', 'data-dismiss' => 'modal'} &times;
    %h3 Nuova attività
  .modal-body
    %form.well.form-inline{"data-bind" => "submit: save"}
      = hidden_field_tag 'id', '', :data => {:bind => "value: id"}
      .row-fluid
        .span6
          .field.control-group
            Commessa
            .controls
              = select_tag :job_order, '', 'ng-model' => 'activity.job_order_id', 'ng-options' => 'j.id as j.code for j in jobOrders'
        .span6
          .field.control-group
            Attività
            .controls
              = select_tag :activity, '', 'ng-model' => 'activity.job_order_activity_id', 'ng-options' => 'j.id as j.description for j in jobOrderActivities'
      .row-fluid
        .span6
          .field.control-group
            Data
            .controls
              = text_field_tag 'date', '', :class => 'isdate input-small', 'ng-model' => "activity.date"
        .span6
          .field.control-group
            Ore
            .controls
              = text_field_tag 'hours', '', :class => 'input-small', 'ng-model' => "activity.hours"
      .row-fluid
        .span12
          .field.control-group
            Note
            .controls
              = text_area_tag :description, '', 'ng-model' => "activity.description"
          
  .modal-footer
    %a.btn{'data-dismiss' => 'modal'} annulla
    %button.btn.btn-primary{:type => 'submit', 'data-dismiss' => 'modal', 'ng-click' => 'save()'} salva    
    
= content_for :side_bar do
  .well.sidebar-nav
    %ul.info-panel
      %li
        %a.btn.btn-primary#openModal{:href => '#newActivity'}
          Nuova attività
      %li
        %a.btn#report{:href => '/user_activities/report.xls'}
          Genera report
    %iframe#frm{:style => "display:none"}
    %hr
    %ul#stats.totals.info-panel  
      %li Oggi
      %li.amount{"data-bind"=>"text: today_hours_txt"}
      %li Ieri
      %li.amount{"data-bind"=>"text: yesterday_hours_txt"}
 