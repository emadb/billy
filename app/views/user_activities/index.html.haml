%h1
  = "Attività di #{current_user.name}"

#activityPage
  %fieldset
    %legend &nbsp;
    %form.well.form-inline{:method => 'POST', :action => '/user_activities/index'}
      Mese:
      = select_month @filter_date, {add_month_numbers: false, :use_short_month => true}, {name: 'month', :class => 'input-small', 'data-bind' => 'value: month'}
      &nbsp;&nbsp;Anno
      = select_year @filter_date, {add_month_numbers: false}, {name: 'year', :class => 'input-small', 'data-bind' => 'value: year'}
      &nbsp;&nbsp;Utente
      = select_tag 'user', options_from_collection_for_select(@users, "_id", "email"), 'data-bind' => 'value: user'
      &nbsp;&nbsp;
      %button.btn{:type => 'button', 'data-bind' => 'click: reload'} filtra

  %table.table.table-striped.table-bordered
    %thead
      %tr
        %td Tipo
        %td Data
        %td Ore
        %td Note
        %td Attività
        %td
    %tbody{"data-bind" => "{foreach: activities}"}
      %tr{"data-bind"=>"{visible: isVisible}"}
        %td{"data-bind"=>"{text: type}"}
        %td{"data-bind"=>"{dateString: date}"}
        %td{"data-bind"=>"{text: hours}"}
        %td{"data-bind"=>"{text: description}"}
        %td{"data-bind"=>"{text: activityJobOrder}"}
        %td
          %a{:href => "#", "data-bind"=> "{click: removeActivity}"}
            %i.icon-remove
       


#newActivity.modal.hide.fade
  .modal-header
    %button.close{:type => 'button', 'data-dismiss' => 'modal'} &times;
    %h3 Nuova attività
  .modal-body
    %form.well.form-inline{"data-bind" => "submit: save"}
      .row
        .span3
          .field.control-group
            Commessa
            .controls
              = select_tag :job_order, '', :data => {:bind => "value: jobOrder, options: jobOrders, optionsValue : 'id', optionsText: 'code'"}
        .span3
          .field.control-group
            Attività
            .controls
              = select_tag :activity, '', :data => {:bind => "value: activity, options: jobOrderActivities, optionsValue : 'id', optionsText: 'description'"}
      .row
        .span6
          .field.control-group
            Categoria
            .controls
              = select_tag :type, '', :data => {:bind => "value: type, options: activityTypes, optionsValue : 'id', optionsText: 'description'"}
      .row
        .span3
          .field.control-group
            Data
            .controls
              = text_field_tag 'date', '', :class => 'isdate input-small', :data => {:bind => "value: date"}
        .span3
          .field.control-group
            Ore
            .controls
              = text_field_tag 'hours', '', :class => 'input-small', :data => {:bind => "value: hours"}
      .row
        .span6
          .field.control-group
            Note
            .controls
              = text_area_tag :description, '', :data => {:bind => "value: description"}
          
  .modal-footer
    %a.btn{'data-dismiss' => 'modal'} annulla
    %button.btn.btn-primary{:type => 'submit', 'data-bind' => 'click:save'} salva    
    
= content_for :side_bar do
  .well.sidebar-nav
    %a.btn.btn-primary{"data-toggle" => "modal", :href => '#newActivity'}
      Nuova attività
    %hr
    %ul#stats.totals.info-panel  
      %li Oggi
      %li.amount{"data-bind"=>"text: today_hours_txt"}
      %li Ieri
      %li.amount{"data-bind"=>"text: yesterday_hours_txt"}
 